<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>AR - Sistema Médico Interativo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

/* ===== TELA DE SELEÇÃO ===== */
#patient-select-screen {
  position: fixed;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #111, #1f1f1f);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

select, button {
  padding: 12px;
  margin-top: 15px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
}

button {
  background: #ff4d4d;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

/* ===== MODAL PACIENTE ===== */
#patient-page {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.patient-card {
  background: white;
  color: black;
  padding: 25px;
  border-radius: 15px;
  width: 90%;
  max-width: 400px;
}

.patient-card h2 {
  margin-top: 0;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<!-- ===== TELA DE SELEÇÃO ===== -->
<div id="patient-select-screen">
  <h1>Selecionar Paciente</h1>

  <select id="patientSelect">
    <option value="">Escolha um paciente</option>
  </select>

  <button id="startAR">Iniciar AR</button>
</div>

<!-- ===== MODAL PACIENTE ===== -->
<div id="patient-page">
  <div class="patient-card">
    <h2>Ficha do Paciente</h2>
    <p><strong>Nome:</strong> <span id="modal-name"></span></p>
    <p><strong>Idade:</strong> <span id="modal-age"></span></p>
    <p><strong>BPM:</strong> <span id="modal-bpm"></span></p>
    <p><strong>SpO₂:</strong> <span id="modal-spo2"></span>%</p>
    <button id="closePatient">Fechar</button>
  </div>
</div>

<!-- ===== CENA AR (INICIALMENTE OCULTA) ===== -->
<a-scene
  id="arScene"
  embedded
  class="hidden"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>
  <a-marker preset="hiro" cursor="rayOrigin: mouse;">
    <a-entity id="heart-container" class="clickable" position="0 0.3 0">
      <a-entity
        id="heart-model"
        gltf-model="url(realistic_human_heart.glb)"
        scale="1 1 1"
        animation="property: scale; from: 0.95 0.95 0.95; to: 1.05 1.05 1.05; dir: alternate; dur: 800; loop: true"
      ></a-entity>
    </a-entity>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>

/* ==============================
   BASE DE DADOS FAKE
================================ */
const patients = [
  { id: 1, name: "João Silva", age: 54, bpm: 88, spo2: 97 },
  { id: 2, name: "Maria Souza", age: 62, bpm: 102, spo2: 95 },
  { id: 3, name: "Carlos Mendes", age: 45, bpm: 76, spo2: 98 }
];

let selectedPatient = null;

/* ==============================
   ELEMENTOS
================================ */
const select = document.getElementById("patientSelect");
const startBtn = document.getElementById("startAR");
const selectScreen = document.getElementById("patient-select-screen");
const arScene = document.getElementById("arScene");
const heartModel = document.getElementById("heart-model");

const patientPage = document.getElementById("patient-page");
const closeBtn = document.getElementById("closePatient");

/* ==============================
   POPULAR SELECT
================================ */
patients.forEach(p => {
  const option = document.createElement("option");
  option.value = p.id;
  option.textContent = p.name;
  select.appendChild(option);
});

/* ==============================
   INICIAR AR
================================ */
startBtn.addEventListener("click", () => {
  const id = parseInt(select.value);

  if (!id) {
    alert("Selecione um paciente!");
    return;
  }

  selectedPatient = patients.find(p => p.id === id);

  selectScreen.style.display = "none";
  arScene.classList.remove("hidden");
});

/* ==============================
   CLICK NO CORAÇÃO
================================ */
heartModel.addEventListener("click", () => {

  if (!selectedPatient) return;

  document.getElementById("modal-name").textContent = selectedPatient.name;
  document.getElementById("modal-age").textContent = selectedPatient.age;
  document.getElementById("modal-bpm").textContent = selectedPatient.bpm;
  document.getElementById("modal-spo2").textContent = selectedPatient.spo2;

  patientPage.style.display = "flex";

  heartModel.pause();
});

/* ==============================
   FECHAR MODAL
================================ */
closeBtn.addEventListener("click", () => {
  patientPage.style.display = "none";
  heartModel.play();
});

</script>
</body>
</html>
