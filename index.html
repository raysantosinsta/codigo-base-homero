<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>AR - Sistema Médico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
}

/* Tela inicial */
#patient-select-screen {
  position: fixed;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg,#111,#222);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

select, button {
  padding: 12px;
  margin-top: 15px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
}

button {
  background: #ff4d4d;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

/* Modal paciente */
#patient-page {
  position: fixed;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.patient-card {
  background: white;
  color: black;
  padding: 25px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
}
</style>
</head>

<body>

<!-- Tela de Seleção -->
<div id="patient-select-screen">
  <h1>Selecionar Paciente</h1>

  <select id="patientSelect">
    <option value="">Escolha um paciente</option>
  </select>

  <button id="startAR">Iniciar AR</button>
</div>

<!-- Modal -->
<div id="patient-page">
  <div class="patient-card">
    <h2>Ficha do Paciente</h2>
    <p><strong>Nome:</strong> <span id="modal-name"></span></p>
    <p><strong>Idade:</strong> <span id="modal-age"></span></p>
    <p><strong>BPM:</strong> <span id="modal-bpm"></span></p>
    <p><strong>SpO₂:</strong> <span id="modal-spo2"></span>%</p>
    <button id="closePatient">Fechar</button>
  </div>
</div>

<script>

/* ===== Base fake ===== */
const patients = [
  { id: 1, name: "João Silva", age: 54, bpm: 88, spo2: 97 },
  { id: 2, name: "Maria Souza", age: 62, bpm: 102, spo2: 95 },
  { id: 3, name: "Carlos Mendes", age: 45, bpm: 76, spo2: 98 }
];

let selectedPatient = null;

/* ===== Elementos ===== */
const select = document.getElementById("patientSelect");
const startBtn = document.getElementById("startAR");
const selectScreen = document.getElementById("patient-select-screen");
const patientPage = document.getElementById("patient-page");
const closeBtn = document.getElementById("closePatient");

/* Popular select */
patients.forEach(p => {
  const option = document.createElement("option");
  option.value = p.id;
  option.textContent = p.name;
  select.appendChild(option);
});

/* Iniciar AR */
startBtn.addEventListener("click", () => {
  const id = parseInt(select.value);

  if (!id) {
    alert("Selecione um paciente!");
    return;
  }

  selectedPatient = patients.find(p => p.id === id);

  selectScreen.remove();

  createARScene();
});

/* ===== Criar cena dinamicamente ===== */
function createARScene() {

  const scene = document.createElement("a-scene");
  scene.setAttribute("embedded", "");
  scene.setAttribute("arjs", "sourceType: webcam; debugUIEnabled: false;");

  scene.innerHTML = `
    <a-marker preset="hiro" cursor="rayOrigin: mouse;">
      <a-entity position="0 0.3 0">
        <a-entity
          id="heart-model"
          gltf-model="url(realistic_human_heart.glb)"
          scale="1 1 1"
          animation="property: scale; from: 0.95 0.95 0.95; to: 1.05 1.05 1.05; dir: alternate; dur: 800; loop: true"
        ></a-entity>
      </a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  `;

  document.body.appendChild(scene);

  /* Esperar carregar */
  scene.addEventListener("loaded", () => {
    const heartModel = document.getElementById("heart-model");

    heartModel.addEventListener("click", () => {
      document.getElementById("modal-name").textContent = selectedPatient.name;
      document.getElementById("modal-age").textContent = selectedPatient.age;
      document.getElementById("modal-bpm").textContent = selectedPatient.bpm;
      document.getElementById("modal-spo2").textContent = selectedPatient.spo2;

      patientPage.style.display = "flex";
      heartModel.pause();
    });

    closeBtn.addEventListener("click", () => {
      patientPage.style.display = "none";
      heartModel.play();
    });

  });
}

</script>
</body>
</html>
